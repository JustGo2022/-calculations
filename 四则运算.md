#include<iostream>
#include <cstdlib>
#include <ctime>
#include<string.h>
using namespace std;
/*typedef struct
{
	char* elem;
	int top;
	int size;
}Sqstack;
//定义操作符栈和操作数栈 
Sqstack Ope;
Sqstack Num;

/void Initstack(Sqstack* s) //初始化栈 
{
	s->size = 10;
	s->top = 0;
	s->elem = (char*)malloc(s->size * sizeof(char));
	if (!s->elem)
	{
		printf(" OVERFLOW ");
	}
}

void Push(Sqstack* s, char e)  //入栈
{
	s->elem[s->top] = e;
	s->top++;
}

void Pop(Sqstack* s)//出栈 
{
	s->top--;
}

char GetTop(Sqstack* s)//取栈顶元素
{
	char e;
	s->top--;
	e = s->elem[s->top];

	return e;
}

void calculate(Sqstack* ope, Sqstack* num)
{

	char num1, num2, op;
	num2 = GetTop(num);
	num1 = GetTop(num);
	op = GetTop(ope);
	int tmpResult = 0;
	switch (op)
	{
	case '+':
		tmpResult = num1 + num2;
		break;
	case '-':
		tmpResult = num1 - num2;
		break;
	case '*':
		tmpResult = num1 * num2;
		break;
	case '/':
		tmpResult = num1 / num2;
		break;
	}
	Push(num, tmpResult);//入栈   
}

int dealExpression()
{
	Initstack(&Ope);
	Initstack(&Num);
	int onechar[50];
	int i = 0;
	while (fgetc(fp1)!=EOF) 
	{
		onechar[i] = fgetc(fp1);
		i++;
	};
	onechar[i] = '\0';
	i = 0;
	while (onechar[i]!= '\0')
	{
		switch (onechar[i])
		{
		case '+':
		case '-':
			Push(&Ope, onechar[i]); //入栈 
			break;
		case '*':
		case '/':
			Push(&Ope, onechar[i]); //入栈 
			calculate(&Ope, &Num);
			break;
		default://onechar为数字，则入num栈  
			while (onechar[i] >= '0' && onechar[i] <= '100');
			Push(&Num,onechar[i]);
			break;
		}//end switch  
	}//end while  
	return GetTop(&Num);
}*/

void wenjian() {
	FILE* fp;
	if ((fp = fopen("算术题册.txt", "w")) == NULL)
	{
		printf("txt文件打开失败即将退出\n");
		exit(0);
	}
}
//表达式存储函数
void chucun1(int a, char b, int c, char d, int e, int sum) {
	FILE* fp;
	if ((fp = fopen("算术题册.txt", "a+")) == NULL)
	{
		printf("txt文件打开失败即将退出\n");
		exit(0);
	}
	else
		fprintf(fp,"%d%c%d%c%d%c%d\n", a, b, c, d, e, '=', sum);
		fclose(fp);
}
void chucun2(int a, char b, int c, char d, int e, char f, int g, int sum) {
	FILE* fp;
	if ((fp = fopen("算术题册.txt", "a+")) == NULL)
	{
		printf("txt文件打开失败即将退出\n");
		exit(0);
	}
	else
		fprintf(fp, "%d %c %d %c %d %c %d %c %d\n", a, b, c, d, e, f, g, '=', sum);
		fclose(fp);
}

int jisuan(int a, char b, int c) {
	switch (b) {
	case '*': return (a * c); break;
	case '/': return (a / c); break;
	case '+': return (a + c); break;
	case '-': return (a - c); break;
	default:break;
	}
	return 0;
}

int yunsuan1(int a, char b, int c, char d, int e)
{
	int new1=0,new2=0;
	if ((d == '/' || d == '*')&&(b !='*' &&  b!='/'))
	{
		new1 = jisuan(c, d, e);
		new2 = jisuan(a, b, new1);
	}
	else
	{
		new1 = jisuan(a, b, c);
		new2 = jisuan(new1,d, e);
	}
	return new2;
}


int yunsuan2(int a, char b, int c, char d, int e,char f,int g)
{
	int new1=0,new2=0,new3=0;
	if(b == '/' || b == '*')
	{
		new1 = jisuan(a, b, c);
		if (d == '/' || d == '*')
		{
			new2 = jisuan(new1,d,e);
			new3 = jisuan(new2, f, g);
		}
		else
		{
			if(f == '/'||f == '*')
			{
				new2 = jisuan(e, f, g);
				new3 = jisuan(new1, d, new2);
			}
			else
			{
				new2 = jisuan(new1, d, e);
				new3 = jisuan(new2, f, g);
			}
		}
		return new3;
	}
	else
	{
		if(d == '/' || d == '*')
		{
			new1 = jisuan(c, d, e);
			if (f == '/' || f == '*')
			{
				new2 = jisuan(new1, f, g);
				new3 = jisuan(a, b, new2);
			}
			else
			{
				new2 = jisuan(a, b, new1);
				new3 = jisuan(new2, f, g);
			}
		}
		else
		{
			new1 = jisuan(a, b, c);
			if (f == '/' || f == '*')
			{
				new2 = jisuan(e, f, g);
				new3 = jisuan(new1, d, new2);
			}
			else 
			{
				new2 = jisuan(new1, d, e);
				new3 = jisuan(new2, f, g);
			}
		}
		return new3;
	}
	return 0;
}


void suanshi() {

	//产生随机整数
	loop: int number1 = rand() % 100;
	int number2 = rand() % 100;
	int number3 = rand() % 100;
	int number4 = rand() % 100;
	//产生随机运算符
	//char ch30[4];
	//char ch00[4];
	//char ch10[4];
	//char ch20[4];
	//itoa(number1, ch30, 10);
	//itoa(number2, ch20, 10);
	//itoa(number3, ch10, 10);
	//itoa(number4, ch00, 10);
	int ch1 = rand() % 4;
	int ch2 = rand() % 4;
	int ch3 = rand() % 4;
	char ch4[4] = { '+','-','*','/' };
	
	int fushu = rand() % 2;//确定运算符个数
	//产生表达式
	int sum = 0;

	if (fushu == 0)
	{
		sum = yunsuan1(number1, ch4[ch1], number2, ch4[ch2], number3);
		if (sum < 0)
		{
			goto loop;
		}
		chucun1(number1, ch4[ch1], number2, ch4[ch2], number3, sum);
		printf("%d%c%d%c%d=%d\n", number1, ch4[ch1], number2, ch4[ch2], number3, sum);
	}
	else if (fushu == 1)
	{
		sum = yunsuan2(number1, ch4[ch1], number2, ch4[ch2], number3, ch4[ch3], number4);
		if (sum < 0)
			goto loop;
		chucun2(number1, ch4[ch1], number2, ch4[ch2], number3, ch4[ch3], number4, sum);
		printf("%d%c%d%c%d%c%d=%d\n", number1, ch4[ch1], number2, ch4[ch2], number3, ch4[ch3], number4, sum);
	}

}

int main() {
	int n;
	cout << "输入产生算式的个数" << endl;
	cin >> n;
	wenjian();
	srand((int)time(0));//将时间作为随机数种子确保真随机
	while (n > 0)
	{
		suanshi();
		n--;
	}
	return 0;
}
